<!DOCTYPE html>
<html>
<head>
    <title></title>
       <meta charset="UTF-8" />

<link rel="stylesheet" href="./css/bootstrap.min.css">
<script src="./js/jquery.js"></script>
<script src="./js/line/highcharts.js" type="text/javascript" ></script>
<script src="./js/line/gray.js" type="text/javascript" ></script>
<script src="./js/line/line.js" type="text/javascript" ></script>
<style type="text/css">
</style>
</head>
<body>
<div class="input-group json">
  <span class="input-group-addon" id="basic-addon1">JSON</span>
  <input type="text" name="json_data" class="form-control" aria-label="...">
  <div class="input-group-btn">
    <button class="btn btn-primary" id="subjson">提交</button>
  </div>
</div>
<div class="input-group csv">
  <span class="input-group-addon" id="basic-addon1">CSV</span>
  <input type="file" id="file4" name="json_data" class="form-control" aria-label="..."/>
  <div class="input-group-btn">
    <button class="btn btn-primary" id="subcsv">提交</button>
  </div>
</div>

<!--     <div class="text-center">
    <input type="text" name="json_data">
    <button class="btn btn-primary" id="subjson">提交</button>
    <input type="file" id="file4"/>
    <button class="btn btn-primary" id="subcsv">submit</button>
    <div> -->
<div class="well">
    <canvas id="myChart" width="400" height="400">
    </canvas>
    <div class="block span8">
        <div class="block-body">
            <div id="chart_1" class="chart"></div>
            <div class="actions pull-right">
                <button class="switcher btn btn-primary" id="column">column</button>
                <button class="switcher btn btn-primary" id="area">area</button>
                <button class="switcher btn btn-primary" id="line">line</button>
                <button class="switcher btn btn-primary" id="spline">Spine</button>
                <button class="switcher btn btn-primary" id="areaspline">areaspline</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $("#subcsv").click(function() {
        // body...
        file=document.getElementById("file4").files[0];
        var reader =new FileReader();
        reader.readAsText(file);
        reader.onload = function() {
            // body...
            var content = this.result;
            lines = content.split("\n");
            var keys = lines[0].split(",");
            var res = [];
            for(var i = 1;i < lines.length;i++){
                if(lines[i].trim().length == 0){
                    continue;
                }
                var row = [];
                for(var k = 0;k < keys.length;k++){
                    line = lines[i].split(",");
                    row.push({"key":keys[k],"value":line[k]});
                }
                res.push(row);
            }
            console.log(res);
            var key = [];
            var value = [];
            res.forEach(function(ele) {
                // body...
                key.push(parseInt(ele[0].value));
                if(value.length == 0){
                    for(var i = 1;i < ele.length;i++){
                        value.push({name:ele[i].key,data:[]});
                    }
                }
                for(var i = 1;i < ele.length;i++){
                    //value.push({name:ele[i].key,data:[]});
                    value[i - 1].data.push(parseInt(ele[i].value));
                }
            })
            chart1 = new Highcharts.Chart({
             chart: {
                renderTo: 'chart_1',
                type: 'line',
                //height: 350,
             },
             title: {
                text: 'PV UV模板'
             },
             xAxis: {
                
                categories: key
             },
             yAxis: {
                title: {
                   text: '营业收入  (单位: 元)'
                }
             },
             series: value
        });
    };
    });
    $("#subjson").click(function(){
        // body...
        var data = $("input:text[name='json_data']").val();
        var obj = eval("["+data+"]");
        var key = [];
        var pv = [];
        var uv = [];
        for(var i in obj[0]){
            pv.push(obj[0][i].pv);
            uv.push(obj[0][i].uv);
            key.push(i);
        }
        chart1 = new Highcharts.Chart({
         chart: {
            renderTo: 'chart_1',
            type: 'line',
            height: 350,
         },
         title: {
            text: 'PV UV模板'
         },
         xAxis: {
            
            categories: key
         },
         yAxis: {
            title: {
               text: '营业收入  (单位: 元)'
            }
         },
         series: [{
            name: 'pv',
            data: pv
         },
         {
            name: 'uv',
            data: uv
         }
         ]
    });
})

</script>
</body>
</html>


